---
title: "Expanding your graphical repertoire"
date: "2022-02-21"
output:
  xaringan::moon_reader:
    css: ["default", "middlebury", "middlebury-fonts", "custom.css"]
    lib_dir: libs
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
      ratio: 16:9
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
knitr::opts_knit$set(root.dir = "../")

library("data.table")
library("ggplot2")
library("knitr")
library("kableExtra")
library("graphclassmate")
library("wrapr")
library("gapminder")

options(
  datatable.print.nrows = 16,
  datatable.print.topn = 6,
  datatable.print.class = TRUE
)

my_table <- function(x){
 x %>% 
  kbl(col.names = NULL) %>%
  kable_styling(position = "float_left", font_size = 18) %>%
  column_spec(1, background = "white") %>%
  column_spec(2, background = "white")  %>%
  add_header_above(c("Variables" = ncol(x)))
}
uniform_point <- geom_point(size = 5, 
                            shape = 21, 
                            color = "black", 
                            fill = rcb("dark_Gray"))

uniform_point_2 <- geom_point(size = 3, 
                              shape = 21, 
                              alpha = 0.75, 
                              color = "black", 
                              fill = rcb("dark_Gray"))

uniform_color <- scale_color_manual(values = "black")
uniform_fill  <- scale_fill_manual(values = rcb("dark_Gray")) 

uniform_jitter <- geom_jitter(size = 5, 
                              shape = 21, 
                              alpha = 0.75, 
                              width = 0, 
                              height = 0.2)

superpose_point <- geom_point(size = 5, shape = 21)

superpose_color <- scale_color_manual(values = c(rcb("dark_Gn"),                                                              rcb("dark_PR")))
superpose_fill_mid <- scale_fill_manual(values = c(rcb("mid_Gn"), 
                                               rcb("mid_PR"))) 
superpose_fill_pale <- scale_fill_manual(values = c(rcb("pale_Gn"), 
                                               rcb("pale_PR"))) 
```

class: right

```{r}
library(magick)
a <- image_read("slides/img/dot-superpose-preview.png")
b <- image_read("slides/img/scatterplot-superpose-preview.png")
c <- image_read("slides/img/time-series-cyclic-preview.png")
d <- image_read("slides/img/boxplot-preview.png")

z <- image_append(c(a, b), stack = TRUE)
z <- image_append(c(z, c), stack = TRUE)
z <- image_append(c(z, d), stack = TRUE)
image_write(z, 
        path = "slides/img/test-composite.png", 
        format = "png")
```


.left-column[
<img src="img/test-composite.png">
]

# Expanding your graphical repertoire

###  Variables + Argument &#x2192; Design

<br>

<br>

Richard Layton   

2022-02-14

<br>

<br>

<https://graphdr.github.io/data-stories/>

<https://github.com/graphdr>

<a href="mailto:graphdoctor@gmail.com">graphdoctor@gmail.com</a>











---
class: left

.left-column[
<img src="img/test-composite.png">
]

#### $\quad$

#### $\quad$ Comparing data

#### $\quad$

<br>

#### $\quad$ Revealing correlations

#### $\quad$

<br>

#### $\quad$ Showing evolution

#### $\quad$

<br>

#### $\quad$ Displaying distributions


<div class="my-footer">
<span>
Optimal design categories from: Jean-luc Doumont (2009) <em>Trees, Maps and Theorems</em>, Principiae, p. 133.
</span>
</div> 























---
class:inverse, center, middle

# Comparing data










---
class: left

# Dot chart

Good substitute for pie charts or bar charts. 

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.7}
dt <- readRDS("data/dot-chart.rds")
ggplot(dt, aes(x = per_thou, y = age)) +
  uniform_point + 
  uniform_color +
  uniform_fill +
  theme_graphclass(font_size = 18) +
  labs(x = "Deaths per 1000 births, 2007-2016", 
       y = "Age", 
       title = "Infants less than one year old born to US citizens") +
  scale_x_continuous(limits = c(3, 18), breaks = seq(0, 50, 5)) +
  theme(axis.title.y = element_text(angle = 0, hjust = 1, vjust = 1))
```
]
.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"         , "structure" |
   "infant mortality" , "quantitative" |
   "age of mother"     , "categorical, ordinal, 6 levels")
my_table(x)
```

<br>

<br>

<br>

- category (age) levels on rows    

- quantities along common horizontal scale
]

<div class="my-footer">
<span>Data source: US Centers for Disease Control and Prevention  
<a href="https://wonder.cdc.gov/lbd-current.html">CDC WONDER Linked Birth / Infant Death Records</a></span>
</div> 










---
class: left

# Dot chart, superposed

Subset by a second category.  

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.7}
dt <- readRDS("data/multiway-2-panel.rds")

ggplot(dt, aes(x = per_thou, y = age, color = race, fill = race)) +
  superpose_point + 
  superpose_color +
  superpose_fill_mid +
  theme_graphclass(font_size = 18) +
  labs(x = "Deaths per 1000 births, 2007-2016", 
       y = "Age", 
       title = "Infants less than one year old born to US citizens") +
  scale_x_continuous(limits = c(3, 18), breaks = seq(0, 50, 5)) +
  theme(axis.title.y = element_text(angle = 0, hjust = 1, vjust = 1), 
        legend.position = "none") +
  annotate("text", 
           x = c(4, 12.5), 
           y = c(5.54, 5.54), 
           label = c("Non-black families", "Black families"), 
           size = 6, 
           hjust = 0)

```
]
.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"         , "structure" |
   "infant mortality" , "quantitative" |
   "age of mother"     , "categorical, ordinal, 6 levels" |
   "race/ethnicity"    , "categorical, nominal, 2 levels")
my_table(x)
```

<br>

<br>

<br>

- category 1 (age) levels on rows

- category 2 (race/ethnicity) color-coded

- quantities along common horizontal scale
]

```{r}
# -------------------- COVER PAGE -------------------- 
p <- ggplot(dt, aes(x = per_thou, y = age, color = race, fill = race)) +
  geom_point(shape = 21) + 
  labs(x = "", y = "") + 
  scale_color_manual(values = c(rcb("dark_Gn"), rcb("dark_PR"))) +
  scale_fill_manual(values = c(rcb("mid_Gn"), rcb("mid_PR"))) +
  theme(legend.position = "none", 
        axis.text  = element_blank(), 
        axis.ticks = element_blank(), 
        plot.margin = unit(c(0, 0, 0, 0), "lines"))

ggsave(filename = "slides/img/dot-superpose-preview.png", 
       width = 3,
       height = 1.8,
       units = "in")
```

<div class="my-footer">
<span>Data source: US Centers for Disease Control and Prevention  
<a href="https://wonder.cdc.gov/lbd-current.html">CDC WONDER Linked Birth / Infant Death Records</a></span>
</div> 















---
class: left

# Multiway dot chart

Same data. Change superposed design to a faceted design. 

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.6}
dt <- readRDS("data/multiway-2-panel.rds")
dt <- dt[, race := paste(race, "families")]
ggplot(dt, aes(x = per_thou, y = age)) +
  uniform_point + 
  facet_wrap(vars(reorder(race, per_thou, median)), as.table = FALSE) + 
  theme_graphclass(font_size = 18) +
  labs(x = "Deaths per 1000 births, 2007-2016", 
       y = "Age", 
       title = "Infants less than one year old born to US citizens") +
  scale_x_continuous(limits = c(3, 18), breaks = seq(0, 50, 5)) +
  theme(axis.title.y = element_text(angle = 0, hjust = 1, vjust = 1))
```
]
.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"         , "structure" |
   "infant mortality" , "quantitative" |
   "age of mother"      , "categorical, ordinal, 6 levels" |
   "race/ethnicity"     , "categorical, nominal, 2 levels")
my_table(x)
```

<br>

<br>

<br>
- category 1 (age) levels on rows

- category 2 (race/ethnicity) levels on panels

- quantities along identical scales
]

<div class="my-footer">
<span>Data source: US Centers for Disease Control and Prevention  
<a href="https://wonder.cdc.gov/lbd-current.html">CDC WONDER Linked Birth / Infant Death Records</a></span>
</div> 


















---
class: left

# Multiway dot chart

Changing one category changes the number of facets. 

```{r echo=FALSE, fig.asp=0.29, fig.width=16}
dt <- readRDS("data/multiway-4-panel.rds")
ggplot(dt, aes(x = per_thou, y = age)) +
  facet_wrap(vars(reorder(region, per_thou, median)), ncol = 4) +
  uniform_point + 
  theme_graphclass(font_size = 20) +
  labs(x = "Deaths per 1000 births, 2007-2016", 
       y = "Age", 
       title = "Infants less than one year old born to US citizens") +
  scale_x_continuous(limits = c(3, 18), breaks = seq(0, 50, 5)) +
  theme(axis.title.y = element_text(angle = 0, hjust = 1, vjust = 1))
```
.left[
```{r echo=FALSE}
x <- build_frame(
   "variable"         , "structure" |
   "infant mortality" , "quantitative" |
   "age of mother"     , "categorical, ordinal, 6 levels" |
   "US region"        , "categorical, nominal, 4 levels" )
my_table(x)
```
].pull-right[
- Rows ordered by age. 

- Facets ordered by median value. 
]

<div class="my-footer">
<span>Data source: US Centers for Disease Control and Prevention  
<a href="https://wonder.cdc.gov/lbd-current.html">CDC WONDER Linked Birth / Infant Death Records</a></span>
</div> 















---
class: left

# Multiway dot chart

Same data. Switching facets and rows yields a different view of the data.  

```{r echo=FALSE, fig.asp=0.22, fig.width=16}
dt <- readRDS("data/multiway-4-panel.rds")


ggplot(dt, aes(x = per_thou, y = reorder(region, per_thou, median))) +
  facet_wrap(vars(age), ncol = 6, as.table = FALSE) +
  uniform_point + 
  theme_graphclass(font_size = 20) +
  labs(x = "Deaths per 1000 births, 2007-2016", 
       y = "", 
       title = "Infants less than one year old born to US citizens") +
  scale_x_continuous(limits = c(3, 18), breaks = seq(0, 50, 5)) +
  theme(axis.title.y = element_text(angle = 0, hjust = 1, vjust = 1))
```
.left[
```{r echo=FALSE}
x <- build_frame(
   "variable"         , "structure" |
   "infant mortality" , "quantitative" |
   "age of mother"     , "categorical, ordinal, 6 levels" |
   "US region"        , "categorical, nominal, 4 levels" )
my_table(x)
```
]
.pull-right[
- Rows ordered by the median value.    

- Facets ordered by age. 
]

<div class="my-footer">
<span>Data source: US Centers for Disease Control and Prevention  
<a href="https://wonder.cdc.gov/lbd-current.html">CDC WONDER Linked Birth / Infant Death Records</a></span>
</div> 
















---
class: left

# Multiway dot chart, superposed

Subset further by superposing a new category&mdash;for a total of 4 variables.   

```{r echo=FALSE, fig.asp=0.29, fig.width=16}
dt <- readRDS("data/multiway-superpose.rds")

# label data in one panel only
per_thou <- c(0.5, 10.5)
age      <- "35-39"
race     <- c("Non-Black\nfamilies", "Black families")
region   <- "West"
my_text  <- data.table(per_thou, age, region, race)

ggplot(dt, aes(x = per_thou, 
               y = age, 
               color = race, 
               fill = race)) +
  facet_wrap(vars(reorder(region, region)), ncol = 4, as.table = FALSE) +
  superpose_point + 
  scale_color_manual(values = c(
    rcb("dark_Gn"), 
    rcb("dark_PR"), 
    rcb("dark_Gn"), 
    rcb("dark_PR")
  )) +
  scale_fill_manual(values = c(
    rcb("mid_Gn"),
    rcb("mid_Gn"), 
    rcb("mid_PR"), 
    rcb("mid_PR")
  )) +
  theme_graphclass(font_size = 20) +
  labs(x = "Deaths per 1000 births, 2007-2016", 
       y = "Age", 
       title = "Infants less than one year old born to US citizens") +
  scale_x_continuous(limits = c(0, 18), breaks = seq(0, 50, 5)) +
  theme(axis.title.y = element_text(angle = 0, hjust = 1, vjust = 1), 
        legend.position = "none") +
  geom_text(data = my_text,
            mapping = aes(x = c(0.2, 10.5), y = 5.35, label = race),
            hjust = 0,
            vjust = 0, 
            size  = 6,
            color = "black")
```

.left[
```{r echo=FALSE}
x <- build_frame(
   "variable"         , "structure" |
   "infant mortality" , "quantitative" |
   "age of mother"    , "categorical, ordinal, 6 levels" |
   "US region"        , "categorical, nominal, 4 levels"  |
   "race/ethnicity"   , "categorical, nominal, 2 levels")
my_table(x)
```
]

.pull-right[
- Direct labeling eliminates the legend. 

- Color palette safe for color-vision-deficient viewers.
]

<div class="my-footer">
<span>Data source: US Centers for Disease Control and Prevention  
<a href="https://wonder.cdc.gov/lbd-current.html">CDC WONDER Linked Birth / Infant Death Records</a></span>
</div> 


















---
class:inverse, center, middle

# Revealing correlations




























---
class: left

# Scatterplot

Designed to reveal correlations between two quantitative variables.

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.3}
dt <- readRDS(file = "data/scatterplot.rds")
dt <- dt[year == max(year)]
ggplot(dt, aes(x = per_capita_gdp/1000, y = lifeExp)) +
  uniform_point_2 +  
  labs(x = "Per capita GDP (kIntl$)", 
       y = "Life expectancy (yr)", 
       title = "Each point is a country in 2021") + 
  scale_x_continuous(limits = c(0, 150)) +
  scale_y_continuous(breaks = seq(20, 80, 10)) +
  theme_graphclass(font_size = 20)
```
]
.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"        , "structure" |
   "life expectancy" , "quantitative" |
   "GDP per capita"  , "quantitative" )
my_table(x)
```

<br>

<br>

<br>

"International dollar" is a hypothetical currency with the same *purchasing power parity* (PPP) as constant US dollars (here, the basis is 2011).

In thousands: "kIntl$"
]

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 









---
class: left

#  Scatterplot, superposed

Subset by a categorical variable, "Global region".

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.3}
dt <- readRDS(file = "data/scatterplot.rds")
dt <- dt[year == max(year)]
ggplot(dt, 
       aes(x = per_capita_gdp/1000, 
           y = lifeExp, 
           color = four_regions)) +
  geom_point(size = 3, 
             shape = 16, 
             alpha = 0.8) + 
  labs(x = "Per capita GDP (kIntl$)", 
       y = "Life expectancy (yr)", 
       title = "Each point is a country in 2021") + 
  scale_x_continuous(limits = c(0, 150)) +
  scale_y_continuous(breaks = seq(60, 80, 10)) +
  theme_graphclass(font_size = 20) +
  theme(legend.position = c(0.8, 0.2), 
        legend.title = element_blank()) +
  scale_color_brewer(
    palette = "PRGn",
    direction = 1
  ) +
  guides(color = guide_legend(reverse = TRUE))
```
]
.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"        , "structure" |
   "life expectancy" , "quantitative" |
   "GDP per capita"  , "quantitative" |
   "global region"   , "categorical, nominal, 4 levels")
my_table(x)
```

<br>

<br>

<br>

- Works best when clusters of subsets are distinct.

- Requires a legend if data cannot be directly labeled. 
]

```{r}
# -------------------- COVER PAGE -------------------- 
p <- ggplot(dt, 
       aes(x = per_capita_gdp/1000, 
           y = lifeExp, 
           color = four_regions)) +
  geom_point() + 
  labs(x = "", y = "") + 
  scale_color_brewer(palette = "PRGn",direction = 1) +
  theme(legend.position = "none", 
        axis.text  = element_blank(), 
        axis.ticks = element_blank(), 
        plot.margin = unit(c(0, 0, 0, 0), "lines"))

ggsave(filename = "slides/img/scatterplot-superpose-preview.png", 
       width = 3,
       height = 1.8,
       units = "in")
```

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 












---
class: left

#  Scatterplot, faceted

Same three variables with "Global region" levels in 4 facets. 

```{r echo=FALSE, fig.asp=0.32, fig.width=16}
dt <- readRDS(file = "data/scatterplot.rds")
dt <- dt[year == max(year)]
dt <- dt[, four_regions := paste(four_regions, "(2021)")]
ggplot(dt, 
       aes(x = per_capita_gdp/1000, 
           y = lifeExp)) +
  facet_wrap(vars(four_regions), ncol = 4) + 
  uniform_point_2 +  
  labs(x = "Per capita GDP (kIntl$)", 
       y = "Life expectancy (yr)") + 
  scale_x_continuous(limits = c(0, 150)) +
  scale_y_continuous(breaks = seq(60, 80, 10)) +
  theme_graphclass(font_size = 20) +
  theme(legend.position = "none")
```

- A legend and color are no longer needed. 

- Facets are ordered by median life expectancy in "graph order."

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 




















---
class: left

#  Scatterplot, faceted

Same three variables with "Global region" levels in 8 facets.

```{r echo=FALSE, fig.width=14, fig.asp=0.4}
dt <- readRDS(file = "data/scatterplot.rds")
dt <- dt[, eight_regions := paste(eight_regions, "(2021)")]
ggplot(dt, aes(x = per_capita_gdp/1000, y = lifeExp)) +
  uniform_point_2 +   
  labs(x = "Per capita GDP (kIntl$)", 
       y = "Life expectancy (yr)") + 
  facet_wrap(vars(reorder(eight_regions, lifeExp, median)), 
             ncol = 4, 
             as.table = FALSE) +
  scale_x_continuous(limits = c(0, 150)) +
  scale_y_continuous(breaks = seq(60, 80, 10)) +
  theme_graphclass(font_size = 17)
```

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 









---
class:inverse, center, middle

# Showing evolution










---
class: left

# Time series

A sequence of discrete-time data, often equally-spaced. Time is the independent variable. 

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.3}
dt <- readRDS(file = "data/time-series-2d.rds")
dt <- dt[country %chin% "United States"]

my_text <- copy(dt)
my_text <- my_text[year %in% c(2021)]

x <- copy(dt)
x <- x[year %in% seq(1971, 2021, 10)]
p <- ggplot(x, aes(x = year, y = lifeExp)) +
  geom_line(linetype = 2, color = "#008837") + 
  geom_point(size = 2, color = "#008837") +
  labs(x = "Year", 
       y = "Life expectancy (yr)") +
  theme_graphclass(font_size = 20) +
  scale_x_continuous(limits = c(1970, 2035), breaks = seq(1970, 2020, 10)) +
  scale_y_continuous(limits = c(60, 85), breaks = seq(50, 90, 5)) +
  theme(legend.position = "none") +
  geom_text(data = my_text, 
            aes(x = 2022, y = lifeExp, label = country), 
            size = 6, 
            vjust = 1, 
            hjust = 0, 
            color = "black")
p
```
]

.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"        , "structure" |
   "life expectancy" , "quantitative" |
   "year"            , "categorical, ordinal" )
my_table(x)
```

<br>

<br>

<br>

- Discrete time (e.g., months or years) is a categorical, not quantitative, variable.

- Dots connected by a dashed line if the points are far apart.  
]

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 











---
class: left

# Time series

A sequence of discrete-time data, often equally-spaced. Time is the independent variable. 

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.3}
p <- p %+% dt
p
```
]

.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
   "variable"        , "structure" |
   "life expectancy" , "quantitative" |
   "year"            , "categorical, ordinal" )
my_table(x)
```

<br>

<br>

<br>

- If the dots are close together, ... 
]

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 












---
class: left

# Time series

A sequence of discrete-time data, often equally-spaced. Time is the independent variable. 

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.3}
ggplot(dt, aes(x = year, y = lifeExp)) +
  geom_line(size = 1.5, color = "#008837") + 
  labs(x = "Year", 
       y = "Life expectancy (yr)") +
  theme_graphclass(font_size = 20) +
  scale_x_continuous(limits = c(1970, 2035), breaks = seq(1970, 2020, 10)) +
  scale_y_continuous(limits = c(60, 85), breaks = seq(50, 90, 5)) +
  theme(legend.position = "none") +
  geom_text(data = my_text, 
            aes(x = 2022, y = lifeExp, label = country), 
            size = 6, 
            vjust = 1, 
            hjust = 0, 
            color = "black")
```
]

.pull-right[

<br>

```{r echo=FALSE}
my_table(x)
```

<br>

<br>

<br>

- If the dots are close together, ...    

  a solid line is often used. 
]

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 
























---
class: left

# Time series, superposed

Time series conditioned by a categorical variable, with all lines in the same facet.

.pull-left[
```{r echo=FALSE, fig.width=7, fig.asp=1/1.3}
dt <- readRDS(file = "data/time-series-2d.rds")

my_text <- copy(dt)
my_text <- my_text[year %in% c(2021)]


ggplot(dt, aes(x = year, y = lifeExp, color = country, fill = country)) +
  geom_line(size = 1.5) + 
  labs(x = "Year", 
       y = "Life expectancy (yr)") +
  theme_graphclass(font_size = 20) +
  scale_x_continuous(limits = c(1970, 2035), breaks = seq(1970, 2020, 10)) +
  scale_y_continuous(limits = c(60, 85), breaks = seq(50, 90, 5)) +
  theme(legend.position = "none") +
  scale_color_brewer(palette = "PRGn") +
  geom_text(data = my_text, 
            aes(x = 2022, y = lifeExp, label = country), 
            size = 6, 
            vjust = c(0.5, 0.5, 0.5, 1), 
            hjust = 0, 
            color = "black")
```
]
.pull-right[

<br>

```{r echo=FALSE}
x <- build_frame(
  "variable"          , "structure" |
    "life expectancy" , "quantitative" |
    "year"            , "categorical, ordinal" |
    "country"         , "categorical, nominal, 4 levels")
my_table(x)
```

<br>

<br>

<br>

- Color is often used to distinguish superposed category levels.   

- Use colors safe for viewers with color-vision-deficiency

- Labels eliminate the need for a legend. 

]

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 








---
class: left

#  Time series, faceted 

```{r echo=FALSE, fig.width=14, fig.asp=0.3}
dt <- readRDS(file = "data/time-series-2d.rds")

ggplot(dt, aes(x = year, y = lifeExp)) +
  geom_line(size = 1.5) + 
  facet_wrap(vars(country), ncol = 4) +
  labs(x = "Year", 
       y = "Life expectancy (yr)") +
  theme_graphclass(font_size = 20) +
  scale_x_continuous(limits = c(1970, 2030), 
                     breaks = seq(1975, 2025, 25)) +
  scale_y_continuous(limits = c(60, 85), breaks = seq(50, 90, 5)) +
  theme(legend.position = "none") +
  scale_color_brewer(palette = "PRGn")
```

.left-column[
Same data in faceted design.
]
.right-column[
```{r echo=FALSE}
x <- build_frame(
   "variable"        , "structure" |
   "life expectency" , "quantitative" | 
   "year"            , "categorical, ordinal", 
   "country"         , "categorical, nominal, 4 levels")
my_table(x)
```
]

<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 










---
class: left

#  Connected scatterplot, faceted

```{r echo=FALSE, fig.width=14, fig.asp=0.3}
dt <- readRDS(file = "data/time-series-2d.rds")
my_text <- copy(dt)
my_text <- my_text[year %in% c(1971, 2021)]

ggplot(dt, aes(x = gdp_k, y = lifeExp, color = year)) +
  geom_path(size = 1.2) + 
  # geom_point(size = 1.5) + 
  facet_wrap(vars(country), scales = "free_x", ncol = 4) +
  scale_x_continuous(limits = c(3, 66)) +
  scale_y_continuous(breaks = seq(50, 90, 5), limits = c(60, 85)) +
  labs(x = "Per capita GDP (kIntl$)", 
       y = "Life expectancy (yr)") +
  theme_graphclass(font_size = 20)  +
  theme(legend.position = "none") +
  geom_text(data = my_text,
            aes(x = gdp_k, y = lifeExp, label = year),
            size = 6,
            hjust = c(-0.1  , -0.1, 
                       1.0  , -0.1,
                       0.2  , -0.1,
                       1.0  ,  0.8),
            vjust = c( 0.5  ,  0.0, 
                       0.0  ,  0.0,
                       1.5  ,  0.5,
                       0.5  , -0.5), 
            color = "black") +
  scale_color_continuous(trans = "reverse")
```


.left-column[
Scatterplot with adjacent points in time connected
]
.right-column[
```{r echo=FALSE}
x <- build_frame(
   "variable"        , "structure" |
   "life expectency" , "quantitative" | 
    "GDP per capita" , "quantitative" |
   "year"            , "categorical, ordinal", 
   "country"         , "categorical, nominal, 4 levels")
my_table(x)
```
]



<div class="my-footer">
<span>Data source:  
<a href="https://www.gapminder.org/data/">Gapminder Foundation</a></span>
</div> 














---
class:left

# Cyclic time series


```{r echo=FALSE, fig.width=14, fig.asp=0.32}
dt <- readRDS("data/time-series-cyclic.rds") 
dt <- dt[hemis == "Arctic"]
my_text <- dt[month == "September" & year == "1979"]

ggplot(dt, aes(x = year, y = extent)) +
  geom_line(size = 1, na.rm = TRUE, color = rcb("dark_Gn")) +
  facet_wrap(vars(month), ncol = 12, strip.position = "bottom") +
  theme_minimal() +
  labs(x = "", 
       y =  expression(paste(10^6, " ", km^2)), 
       title= "Extent of polar ice for a given month, 1979-2021") +
  theme(axis.text.x = element_blank(), 
        axis.title.y = element_text(angle = 0, size = 14), 
        panel.grid.major.x = element_blank(), 
        panel.grid.minor.x = element_blank(), 
        strip.text = element_text(size = 14), 
        axis.text = element_text(size = 18), 
        plot.title = element_text(size = 18)
        ) +
  geom_text(data = my_text,
            mapping = aes(x = year, 
                          y = extent + 2, 
                          label = hemis),
            hjust = 0,
            size = 6,
            color = rcb("mid_Gray")) +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, 5))
```

.left-column[
Showing the behavior of cyclic sub-series.
]
.right-column[
```{r echo=FALSE}
x <- build_frame(
   "variable"   , "structure" |
   "ice extent" , "quantitative" | 
   "year"       , "categorical, ordinal, 43 levels" |
   "month"      , "categorical, ordinal, 12 levels" )
my_table(x)
```
]

<div class="my-footer">
<span>Data source: NASA National Snow and Ice Data Center  
<a href="https://nsidc.org/arcticseaicenews/sea-ice-tools/">Sea ice extent and area organized by year</a></span>
</div> 








---
class:left

# Cyclic time series, superposed

```{r echo=FALSE, fig.width=14, fig.asp=0.32}
dt <- readRDS("data/time-series-cyclic.rds") 
my_text <- dt[month == "September" & year == "1979"]

ggplot(dt, aes(x = year, y = extent, color = hemis)) +
  geom_line(size = 1, na.rm = TRUE) +
  facet_wrap(vars(month), ncol = 12, strip.position = "bottom") +
  theme_minimal() +
  labs(x = "", 
       y =  expression(paste(10^6, " ", km^2)), 
       title= "Extent of polar ice for a given month, 1979-2021") +
  theme(axis.text.x = element_blank(), 
        axis.title.y = element_text(angle = 0, size = 14), 
        panel.grid.major.x = element_blank(), 
        panel.grid.minor.x = element_blank(), 
        strip.text = element_text(size = 14), 
        axis.text = element_text(size = 18), 
        plot.title = element_text(size = 18), 
        legend.position = "none"
        ) +
  scale_color_manual(values = c(rcb("dark_PR"), rcb("dark_Gn"))) +
  geom_text(data = my_text,
            mapping = aes(x = year, 
                          y = extent + c(2, -1.7), 
                          label = hemis),
            hjust = c(0, 0),
            size = 6,
            color = rcb("mid_Gray")) +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, 5))
```
.left-column[
Adding *hemisphere* as a categorical variable. 
]
.right-column[
```{r echo=FALSE}
x <- build_frame(
   "variable"   , "structure" |
   "ice extent" , "quantitative" | 
   "year"       , "categorical, ordinal, 43 levels" |
   "month"      , "categorical, ordinal, 12 levels" |
   "hemisphere" , "categorical, nominal, 2 levels")
my_table(x)
```
]

```{r include=FALSE}
# -------------------- COVER PAGE -------------------- 
ggplot(dt, aes(x = year, y = extent, color = hemis)) +
  geom_line(size = 0.3, na.rm = TRUE) +
  facet_wrap(vars(month), ncol = 12) +
  labs(x = "", y = "") +
  scale_color_manual(values = c(rcb("dark_PR"), rcb("dark_Gn"))) +
  theme(legend.position = "none", 
        axis.text  = element_blank(), 
        axis.ticks = element_blank(), 
        plot.margin = unit(c(0, 0, 0, 0), "null"),
        panel.spacing = unit(0.04, "lines"),
        panel.grid.major.x = element_blank(), 
        panel.grid.minor.x = element_blank(), 
        panel.grid.major.y = element_blank(), 
        panel.grid.minor.y = element_blank(), 
        strip.text = element_blank())

ggsave(filename = "slides/img/time-series-cyclic-preview.png", 
       width = 3,
       height = 1.8,
       units = "in")
```

<div class="my-footer">
<span>Data source: NASA National Snow and Ice Data Center  
<a href="https://nsidc.org/arcticseaicenews/sea-ice-tools/">Sea ice extent and area organized by year</a></span>
</div> 













---
class:inverse, center, middle

# Displaying distributions












---
class: left

# Strip chart

Designed to display the distribution of a single quantitative variable.

<br>

```{r, fig.asp = 0.15, fig.width = 16}
# full distribution, jittered
library("GDAdata")

# for using uniform manual color and fill 
SpeedSki$dummy <- "dummy"
set.seed(20181216)
ggplot(SpeedSki, aes(x = Speed, y = 0, color = dummy, fill = dummy)) +
  uniform_jitter +
  uniform_color +
  uniform_fill + 
  scale_y_continuous(limits = 1.5 * c(-1, 1)) +
  theme_graphclass(font_size = 20) +
  labs(x = "Speed (km/hr)", 
       y = "", 
       title = "Each marker is one skier in one event") +
  theme(axis.text.y = element_blank(), 
        panel.grid.major.y = element_blank(), 
        panel.grid.minor.y = element_blank(), 
        legend.position = "none")
```

<br>

.pull-left[
```{r echo=FALSE}
x <- build_frame(
   "variable" , "structure" |
   "speed"    , "quantitative")
my_table(x)
```
]
.pull-right[
- Designed to show all data values

- Data markers "jittered" to mitigate overprinting
]

<div class="my-footer">
<span>Data source: 2011 World speed skiing competition, in the
<a href="https://CRAN.R-project.org/package=GDAdata">GDAdata</a> R package</span>
</div> 











---
class: left

# Strip chart

Subset by a category and distinguish levels by row.  

<br>

```{r, fig.asp = 0.2, fig.width = 16}
# full distribution, jittered
set.seed(20181216)
ggplot(SpeedSki, aes(x = Speed, 
                     y = reorder(Event, Speed, median), 
                     color = dummy,
                     fill = dummy
                     )) +
  uniform_jitter +
  uniform_color +
  uniform_fill + 
  theme_graphclass(font_size = 20) +
  labs(x = "Speed (km/hr)", 
       y = "", 
       title = "Each marker is one skier") +
  theme(panel.grid.minor.y = element_blank(), 
        legend.position = "none")
```

.pull-left[
```{r echo=FALSE}
x <- build_frame(
   "variable"   , "structure" |
   "speed"      , "quantitative" |
   "event"      , "categorical, nominal, 3 levels")
my_table(x)
```
]
.pull-right[
- Rows ordered by median value

- Common horizontal scale 
]

<div class="my-footer">
<span>Data source: 2011 World speed skiing competition, in the
<a href="https://CRAN.R-project.org/package=GDAdata">GDAdata</a> R package</span>
</div> 










---
class: left

# Strip chart, superposed

Subset by another category and distinguish levels color-coded. 

<br>

```{r, fig.asp = 0.2, fig.width = 16}
# full distribution, jittered
set.seed(20181216)
ggplot(SpeedSki, aes(x = Speed, 
                     y = reorder(Event, Speed, median), 
                     color = Sex, 
                     fill = Sex)) +
  uniform_jitter +
  superpose_color + 
  superpose_fill_mid +
  theme_graphclass(font_size = 20) +
  labs(x = "Speed (km/hr)", 
       y = "", 
       title = "Each marker is one skier") +
  theme(panel.grid.minor.y = element_blank(), 
        legend.position = "none") +
  geom_text(aes(x = 200, 
                y = 2.6, 
                label = "women"), 
            color = rcb("dark_Gn"), 
            size = 7) +
  geom_text(aes(x = 210, 
                y = 2.6, 
                label = "men"), 
            color = rcb("dark_PR"), 
            size = 7)
```

.pull-left[
```{r echo=FALSE}
x <- build_frame(
   "variable"   , "structure" |
   "speed"      , "quantitative" |
   "event"      , "categorical, nominal, 3 levels", 
   "sex"        , "categorical, nominal, 2 levels")
my_table(x)
```
]
.pull-right[
- Direct labeling eliminates the legend

- Colors safe for color-vision-deficient viewers 
]

<div class="my-footer">
<span>Data source: 2011 World speed skiing competition, in the
<a href="https://CRAN.R-project.org/package=GDAdata">GDAdata</a> R package</span>
</div> 
















---
class: left

# Box and whisker chart

Designed to summarize the distribution of a single quantitative variable.

<br>

```{r, fig.asp = 0.15, fig.width = 16}
dt <- readRDS("data/boxplot.rds")
ggplot(dt, aes(x = enrolled)) +
  geom_boxplot(size = 1, 
               width = 0.5, 
               color = "black", 
               fill = rcb("pale_Gray")) +
  labs(x = "Time to graduate (yr)", 
       y = "", 
       title = "Graduates of 4-year US universities (N = 269,057)") +
  theme_graphclass(font_size = 20) +
  theme(axis.text.y        = element_blank(), 
        panel.grid.major.y = element_blank(), 
        panel.grid.minor.y = element_blank(), 
        axis.ticks.y       = element_blank()) +
  scale_y_continuous(limits = c(-1, 1))
```

<br>

.pull-left[
```{r echo=FALSE}
x <- build_frame(
   "variable"   , "structure" |
   "years"      , "quantitative")
my_table(x)
```
]
.pull-right[
- Shows a 5-point summary of distributions 

- Useful when too much data for a strip chart 
]

<div class="my-footer">
<span>Data source: MIDFIELD subset from the 
<a href="https://github.com/graphdr/graphclassmate">graphclassmate</a> R package</span>
</div> 













---
class: left

# Box and whisker chart

Subset by a category and distinguish levels by row.

<br>

```{r, fig.asp = 0.16, fig.width = 16}
dt <- readRDS("data/boxplot-compare.rds")
dt <- dt[, path := paste(path, "students")]
ggplot(dt, aes(x = enrolled, y = reorder(path, -enrolled, median))) +
  geom_boxplot(size = 1, 
               width = 0.45, 
               outlier.shape = NA, 
               color = "black", 
               fill = rcb("pale_Gray")) +
  labs(x = "Time to graduate (yr)", 
       y = "", 
       title = "Graduates of 4-year US universities (N = 269,057)") +
  theme_graphclass(font_size = 20) +
  theme(panel.grid.major.y = element_blank(), 
        panel.grid.minor.y  = element_blank(), 
        axis.ticks.y       = element_blank())
```

<br>

.pull-left[
```{r echo=FALSE}
x <- build_frame(
   "variable" , "structure" |
   "years"    , "quantitative" |
   "group"    , "categorical, nominal, 2 levels" )
my_table(x)
```
]
.pull-right[
- Convention "up" is "better", so row medians decrease from bottom to top

- Outliers omitted 
]

<div class="my-footer">
<span>Data source: MIDFIELD subset from the 
<a href="https://github.com/graphdr/graphclassmate">graphclassmate</a> R package</span>
</div> 














---
class: left

# Box and whisker chart

Merge two categories (path and sex) into a new "Group" category

<br>

```{r, fig.asp = 0.23, fig.width = 16}
dt <- readRDS("data/boxplot-merge-category.rds")
dt <- dt[, path := paste(path, "students")]
dt <- dt[, sex_path := paste(sex_path, "students")]
ggplot(dt, aes(x = enrolled, 
               y = reorder(sex_path, -enrolled, median), 
               fill = path, 
               color = path
               )) +
  geom_boxplot(size = 1, width = 0.45, outlier.shape = NA) +
  superpose_color +
  superpose_fill_pale +
  labs(x = "Time to graduate (yr)", 
       y = "", 
       title = "Graduates of 4-year US universities (N = 269,057)") +
  theme_graphclass(font_size = 20) +
  theme(panel.grid.major.y = element_blank(), 
        panel.grid.minor.y  = element_blank(), 
        axis.ticks.y       = element_blank(), 
        legend.key.height  = unit(15, "mm"))+ 
  guides(fill = guide_legend(title = NULL, reverse = TRUE),
         color = "none")
```

  
<br>

.pull-left[
```{r echo=FALSE}
x <- build_frame(
   "variable" , "structure" |
   "years"    , "quantitative" |
   "group"    , "categorical, nominal, 4 levels" |
    "path"    , "categorical, nominal, 2 levels")
my_table(x)
```
]
.pull-right[
- Direct comparison easier without facets

- Color encodes the "path" category
]


```{r}
# -------------------- COVER PAGE -------------------- 
p <- ggplot(dt, aes(x = enrolled, 
               y = reorder(sex_path, -enrolled, median), 
               fill = path, 
               color = path
               )) +
  geom_boxplot(size = 0.2, width = 0.45, outlier.shape = NA) +
  superpose_color +
  superpose_fill_pale +
  labs(x = "", y = "") +
  theme(legend.position = "none", 
        axis.text  = element_blank(), 
        axis.ticks = element_blank(), 
        plot.margin = unit(c(0, 0, 0, 0), "null"),
        panel.spacing = unit(0.02, "lines"),
        # panel.grid.major.x = element_blank(), 
        panel.grid.minor.x = element_blank(), 
        panel.grid.major.y = element_blank(), 
        panel.grid.minor.y = element_blank(), 
        strip.text = element_blank())

ggsave(filename = "slides/img/boxplot-preview.png", 
       width = 3,
       height = 1.8,
       units = "in")
```


<div class="my-footer">
<span>Data source: MIDFIELD subset from the 
<a href="https://github.com/graphdr/graphclassmate">graphclassmate</a> R package</span>
</div> 


















---
class:inverse, center, middle

# Summary

## Chart design and rhetorical considerations






---
class: left

# Chart design

.pull-left[
**Chart selection** 

- What are your variables, by name?

- Is a variable quantitative or categorical?

- Is a categorical variable naturally ordered (ordinal) or not (nominal)?

- Starting with a small number of variables, what chart types match the data structure? 

- How does the chart type change as you add new variables?
]
.pull-right[
**Chart aesthetics**

- Superposed designs work best with small numbers of subsets or when the subsets visually cluster. 

- Faceted designs permit a greater number of subsets to be compared. 

- Deliberately assign the size, shape, and color of every visual element.  

- Use color deliberately. Choose colors that are safe for color-vision-deficient viewers.
]







---
class: left

# Rhetorical considerations

.pull-left[
**Audience and message** 

- What is your story?

- Does the visual evidence directly support your verbal argument? 

- Have you placed the story in context visually? 

- Who is your audience? 

- Will the audience resist your conventions? 

- If so, is overcoming audience resistance worth the effort? 
]
.pull-right[
**Ethics of visual rhetoric** 

- Is your design equitable and inclusive? 

- Are you seeing only what you want to see? What the audience wants to see? 

- All there alternative explanations for what the chart shows? 

- Are your data dubious? Insufficient?

- Have you concealed information? Concealed a large uncertainty? 

- Does your chart suggest misleading patterns? 
]




---
class:inverse, center, middle

# Appendix

## When you have more variables 






---
class: left


# When you have more variables, look for appropriate designs 

### Our examples have used a limited number of variables

- 2 quantitative variables or less

- 3 categorical variables or less


### Expanding your multivariate graphical repertoire

- scatterplot matrix

- co-plot  

- open-high-low-close (OHLC) chart

- parallel coordinate chart

- survey stacked-bar  chart










---
class: left

# Scatterplot matrix

A grid of scatterplots showing the bivariate relationships between all pairs of variables.   

.pull-left[
Designed for datasets with a large number of quantitative variables. 

Density plots (one per variable) on the diagonal. 

Pearson correlation coefficients for each pair in the upper triangle.  

Example: banknote dimensions, 100 each genuine and counterfeit 

- 6 quantities    
- 1 category

]
.pull-right[
<img src="img/scatterplot-matrix-example.png" style="height:425px">
]

<div class="my-footer">
<span>
Data source: <em>bank</em> dataset included with the <a href="https://CRAN.R-project.org/package=gclus">gclus</a> R package
</span>
</div> 










---
class: left

# Conditioning plot (co-plot)

A grid of scatterplots of two quantities that depend on ranges of one or two additional quantities. 

  
.pull-left[
Designed for datasets with 3 or 4 quantitative variables. 

The ranges of the conditioning variables are shown in panels adjacent to the main grid. 

Example: air quality measurements

- 4 quantities 


]
.pull-right[
<img src="img/conditioning-plot-example.png" style="height:425px">
]

<div class="my-footer">
<span>
Data source: <em>airquality</em> dataset included in the <a href="https://cran.r-project.org/">base R</a> installation
</span>
</div> 



















---
class: left

# Open-high-low-close (OHLC) chart

Time series of market prices.  
  
.left-column[
Color can indicate levels of a category: 

- close > open (green)
- close < open (red)


Example

- 4 quantities
- 2 categories

]
.right-column[
<img src="img/financial-ohlc-example.png" style="height:425px">
]

<div class="my-footer">
<span>
Image from: <a href="https://datavizcatalogue.com/methods/OHLC_chart.html">
The data visualization Decalogue</a >
</span>
</div> 















---
class: left

# Parallel coordinate chart

Each variable has its own vertical axis (usually scaled min to max). Each observation is a line. 



  
.left-column[

Designed for datasets with a large number of quantitative variables.
 
Example: banknote dimensions, 100 each genuine and counterfeit 

- 6 quantities
- 1 category

]
.right-column[
<img src="img/parallel-coord-example.png">
]

<div class="my-footer">
<span>
Data source: <em>bank</em> dataset included with the <a href="https://CRAN.R-project.org/package=gclus">gclus</a> R package
</span>
</div> 




















---
class: left

# Survey stacked-bar chart

Compare responses to Likert-style survey questions. Each bar shows 100% of responses to a question.  

.pull-left[
Colored segments represent percentage shares for the category levels:  Strongly Disagree, Disagree, Neutral, Agree, Strongly Agree. 

Three approaches, each with their own advantages. 

- diverging 
- diverging with separate neutral 
- 100% stacked bars 

Data

- 2 categories (questions, responses)
- 1 quantity (percent share)
]
.pull-right[
<img src="img/likert-example-1.png" style="height:130px">
<img src="img/likert-example-2.png" style="height:130px">
<img src="img/likert-example-3.png" style="height:130px">
]


<div class="my-footer">
<span>
Images from: Lisa Charlotte Muth and Gregor Aisch (2018) 
<a href="https://blog.datawrapper.de/divergingbars/">
The case against diverging stacked bars</a> Data wrapper blog. 
</span>
</div> 




---
class:inverse, center, middle
